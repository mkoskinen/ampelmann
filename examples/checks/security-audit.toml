# Security & Anomaly Detection - focus on actual compromise indicators
name = "security-audit"
description = "Daily security audit for suspicious activity"
enabled = true
schedule = "0 6 * * *"  # 6am daily
timeout = 60
sudo = true

command = """
echo "=== SECURITY AUDIT $(date) ==="

echo "### SUCCESSFUL LOGINS (24h) ###"
journalctl -u sshd --since "24 hours ago" -q 2>/dev/null | grep -i "accepted" | tail -15

echo "### SUDO COMMANDS (24h) ###"
journalctl SYSLOG_IDENTIFIER=sudo --since "24 hours ago" -q 2>/dev/null | tail -20

echo "### LISTENING PORTS ###"
ss -tlnp 2>/dev/null | grep LISTEN

echo "### CRON JOBS ###"
cat /etc/crontab /var/spool/cron/* 2>/dev/null | grep -v "^#" | grep -v "^$"
ls /etc/cron.d/ 2>/dev/null

echo "### SETUID BINARIES ###"
find /usr/bin /usr/sbin /bin /sbin -perm -4000 2>/dev/null | head -20
"""

[llm]
model = "qwen2.5-coder:32b-instruct-q4_K_M"
timeout = 1800
history_context = 3
prompt = """
Review this security audit. Reply with STATUS: OK or STATUS: ALERT on the first line.

ALERT: new IPs in logins, unexpected sudo users, new listening ports, new cron jobs, new setuid binaries.

Compare with previous runs. Be specific (IPs, users, ports, paths).
"""

[notify]
priority = "urgent"
tags = ["security"]
